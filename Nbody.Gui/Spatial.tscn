[gd_scene load_steps=27 format=2]

[ext_resource path="res://src/Nodes/Controls/DebugPanel.cs" type="Script" id=1]
[ext_resource path="res://camera_controll.gd" type="Script" id=2]
[ext_resource path="res://planetShader.tres" type="Material" id=3]
[ext_resource path="res://models/arrow.obj" type="ArrayMesh" id=4]
[ext_resource path="res://src/Nodes/Controls/ControlledButton.cs" type="Script" id=5]
[ext_resource path="res://src/Nodes/Controls/DebugGrid.cs" type="Script" id=6]
[ext_resource path="res://src/Nodes/Spatials/Nbody.cs" type="Script" id=7]
[ext_resource path="res://src/Nodes/Controls/PlanetSystemSelected.cs" type="Script" id=8]
[ext_resource path="res://src/Nodes/Controls/GraphContainer.cs" type="Script" id=9]
[ext_resource path="res://src/Nodes/Controls/DebugList.cs" type="Script" id=10]
[ext_resource path="res://src/Nodes/Controls/FunctionList.cs" type="Script" id=11]
[ext_resource path="res://src/Nodes/Controls/PropsEdit.cs" type="Script" id=12]
[ext_resource path="res://src/Nodes/Spatials/PlanetSystemMultyMesh.cs" type="Script" id=13]
[ext_resource path="res://src/Nodes/Spatials/PlanetSystemArrowMultiMesh.cs" type="Script" id=14]
[ext_resource path="res://src/Nodes/Controls/LinesDrawer.cs" type="Script" id=15]
[ext_resource path="res://src/Nodes/Controls/PlanetSelectList.cs" type="Script" id=16]

[sub_resource type="ButtonGroup" id=1]

[sub_resource type="ButtonGroup" id=2]

[sub_resource type="Shader" id=3]
code = "shader_type canvas_item;
//render_mode skip_vertex_transform;
uniform vec2 offset;
uniform vec2 center;
uniform vec2 resolution;
uniform float width;
uniform float modNum;
//void vertex() {
//    vec2 xxx =  resolution / 2f;
//    float aspect = resolution.x / resolution.y;
//    vec2 z = vec2(width / resolution.x, (width / aspect) / resolution.y);
//    VERTEX = center + ((xxx - vec2(-offset.x, offset.y) - VERTEX.xy) * mat2(vec2(z.x, 0), vec2(0, z.y)) );
//}
void fragment() {
    vec2 xxx =  resolution / 2f;
    float aspect = resolution.x / resolution.y;
    float mn = modNum;
    vec2 z = vec2(width / resolution.x, (width / aspect) / resolution.y);
    float off = 1f;
    vec2 fo =   center + ((xxx - vec2(-offset.x, offset.y) - FRAGCOORD.xy) * mat2(vec2(z.x, 0), vec2(0, z.y)) );
    float fol =  abs(mod((center + ((xxx - vec2(-offset.x, offset.y) - FRAGCOORD.xy - vec2(-off, 0)) * mat2(vec2(z.x, 0), vec2(0, z.y)))).x, mn));
    float foor = abs(mod((center + ((xxx - vec2(-offset.x, offset.y) - FRAGCOORD.xy - vec2(off, 0)) * mat2(vec2(z.x, 0), vec2(0, z.y)))).x, mn));
    float fot =  abs(mod((center + ((xxx - vec2(-offset.x, offset.y) - FRAGCOORD.xy - vec2(0, off)) * mat2(vec2(z.x, 0), vec2(0, z.y)))).y, mn));
    float fob =  abs(mod((center + ((xxx - vec2(-offset.x, offset.y) - FRAGCOORD.xy - vec2(0, -off)) * mat2(vec2(z.x, 0), vec2(0, z.y)))).y, mn));
    
//    vec2 zzz = vec2(mix(vec2(0, SCREEN_PIXEL_SIZE.x), vec2(width, width), FRAGCOORD.x), mix(vec2(0, SCREEN_PIXEL_SIZE.y), vec2(-1, 1), FRAGCOORD.y));
    float to = 0.004;
    COLOR = vec4(1, 1, 1, 1);
//    if (abs(mod(fo.x, mn)) < to*width || abs(mod(fo.y, mn)) < to*width/aspect) {
        float curx = abs(mod(fo.x, mn));
        float cury = abs(mod(fo.y, mn));
        if (curx <= fol && curx <= foor || cury <= fot && cury <= fob){
            float b = min(abs(mod(fo.x, mn)), abs(mod(fo.y, mn)));
            b = 0.5f; //2f - exp(b/(0.005*width));
            COLOR = vec4(b, b, b, 1f);    
//        }
    }
    if (abs(mod(fo.x, mn*5f)) < 0.005*width || abs(mod(fo.y, mn*5f)) < 0.005*width/aspect) {
        COLOR = vec4(0, 0, 0, 1);
    }
    if (abs(fo.x) < 0.005*width || abs(fo.y) < 0.005*width/aspect) {
        COLOR = vec4(1, 0, 0, 1);
    }
//    for(int i =0;i<NPoints;i++) {
//        vec4 p = texelFetch(points, ivec2(i, 0), 1);
//        vec3 k = vec3(p.r - p.b, p.g - p.a, 1);
////        float g = fo * k;
//    }
}"

[sub_resource type="ShaderMaterial" id=4]
shader = SubResource( 3 )
shader_param/offset = Vector2( 100, 100 )
shader_param/center = Vector2( 0, 0 )
shader_param/resolution = Vector2( 771, 528 )
shader_param/width = 2.0
shader_param/modNum = 1.0

[sub_resource type="Shader" id=5]
code = "shader_type canvas_item;
uniform vec2 offset;
uniform vec2 center;
uniform vec2 resolution;
uniform float width;

void vertex() {
    vec2 xxx =  resolution / 2f;
    float aspect = resolution.x / resolution.y;
    vec2 z = vec2(-resolution.x / width, resolution.y / (width / aspect));
    mat2 scale = mat2(vec2(z.x, 0), vec2(0, z.y));
//    VERTEX = center + ((xxx - vec2(-offset.x, offset.y) - VERTEX.xy) * mat2(vec2(z.x, 0), vec2(0, z.y)) );   
    VERTEX += vec2(center.x, center.y);
    VERTEX *= scale;
    VERTEX = vec2(xxx.x, xxx.y + offset.y) - VERTEX;
    POINT_SIZE = 1f;
}"

[sub_resource type="ShaderMaterial" id=6]
shader = SubResource( 5 )
shader_param/offset = Vector2( 100, 100 )
shader_param/center = null
shader_param/resolution = Vector2( 771, 528 )
shader_param/width = 2.0

[sub_resource type="SpatialMaterial" id=7]
next_pass = ExtResource( 3 )
albedo_color = Color( 0.87451, 0.988235, 0.0901961, 1 )

[sub_resource type="SphereMesh" id=8]
material = SubResource( 7 )

[sub_resource type="MultiMesh" id=9]
transform_format = 1
mesh = SubResource( 8 )

[sub_resource type="MultiMesh" id=10]
transform_format = 1
mesh = ExtResource( 4 )

[node name="Spatial" type="Spatial"]
script = ExtResource( 7 )

[node name="Camera" type="Camera" parent="."]
transform = Transform( 0.736745, -0.417058, 0.532231, 0, 0.787125, 0.616794, -0.676171, -0.45442, 0.57991, 10, 10, 20 )
far = 200000.0
script = ExtResource( 2 )
pitch_limit = 80
max_speed = Vector3( 100, 100, 100 )

[node name="DirectionalLight" type="DirectionalLight" parent="."]
transform = Transform( -0.637582, 0.0275111, 0.769892, -0.00167276, 0.99931, -0.0370944, -0.770381, -0.0249385, -0.637096, 3.17719, 4.29856, 0 )
light_energy = 7.46
light_indirect_energy = 5.69
shadow_enabled = true

[node name="Spatial" type="Spatial" parent="."]
visible = false

[node name="Planet" type="CSGSphere" parent="Spatial"]
layers = 2
material = ExtResource( 3 )

[node name="ArrowSpatial" type="Spatial" parent="."]
visible = false

[node name="ArrowModel" type="CSGMesh" parent="ArrowSpatial"]
transform = Transform( 0.5, 0, 0, 0, 1, 0, 0, 0, 0.5, 0, 2, 0 )
mesh = ExtResource( 4 )

[node name="PlanetLightSpatial" type="Spatial" parent="."]
visible = false

[node name="PlanetLight" type="SpotLight" parent="PlanetLightSpatial"]
transform = Transform( 1, 0, 0, 0, -1.62921e-07, -1, 0, 1, -1.62921e-07, 0, 0, 0 )
light_energy = 12.46
light_indirect_energy = 2.03
spot_range = 17.8
spot_angle = 79.2
spot_angle_attenuation = 0.554785

[node name="Panel" type="Panel" parent="."]
visible = false
anchor_right = 1.0
anchor_bottom = 1.0
margin_right = 2.0
margin_bottom = 1.0
__meta__ = {
"_edit_use_anchors_": false
}

[node name="PlanetsContainer" type="VBoxContainer" parent="Panel"]
anchor_right = 0.239
anchor_bottom = 0.293
margin_top = 2.0
margin_right = -0.214005
margin_bottom = -0.0930023
__meta__ = {
"_edit_use_anchors_": false
}

[node name="PlanetsList" type="ItemList" parent="Panel/PlanetsContainer"]
margin_right = 245.0
margin_bottom = 174.0
size_flags_horizontal = 3
size_flags_vertical = 3
select_mode = 1
script = ExtResource( 16 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="FunctionsContainer" type="VBoxContainer" parent="Panel"]
anchor_top = 0.323
anchor_right = 0.239
anchor_bottom = 0.739
margin_top = -0.123001
margin_right = -0.214005
margin_bottom = -0.139008
__meta__ = {
"_edit_use_anchors_": false
}

[node name="FunctionsList" type="ItemList" parent="Panel/FunctionsContainer"]
margin_right = 245.0
margin_bottom = 250.0
size_flags_horizontal = 3
size_flags_vertical = 3
allow_reselect = true
script = ExtResource( 11 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="ControllButtons" type="Panel" parent="Panel"]
anchor_left = 0.24
anchor_right = 0.24
margin_left = -0.23999
margin_top = 2.12096
margin_right = 775.76
margin_bottom = 32.121
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Restart" type="Button" parent="Panel/ControllButtons"]
anchor_top = 0.2
anchor_bottom = 0.2
margin_left = 22.4485
margin_top = 0.178177
margin_right = 88.4485
margin_bottom = 20.1782
focus_neighbour_top = NodePath("../GridContainer")
group = SubResource( 1 )
text = "Restart"
script = ExtResource( 5 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Pause" type="Button" parent="Panel/ControllButtons"]
anchor_top = 0.2
anchor_bottom = 0.2
margin_left = 93.7
margin_top = 0.178177
margin_right = 143.7
margin_bottom = 20.1782
focus_neighbour_top = NodePath("../GridContainer")
group = SubResource( 2 )
text = "Pause"
script = ExtResource( 5 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Step" type="Button" parent="Panel/ControllButtons"]
anchor_left = 0.487
anchor_top = 0.161
anchor_right = 0.487
anchor_bottom = 0.161
margin_left = -0.155029
margin_top = -0.0122104
margin_right = 49.845
margin_bottom = 19.9878
focus_neighbour_top = NodePath("../GridContainer")
group = SubResource( 2 )
text = "Step"
script = ExtResource( 5 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="NSteps" type="Button" parent="Panel/ControllButtons"]
anchor_left = 0.489
anchor_top = 0.161
anchor_right = 0.489
anchor_bottom = 0.161
margin_left = 53.293
margin_top = -0.0122104
margin_right = 110.293
margin_bottom = 19.9878
focus_neighbour_top = NodePath("../GridContainer")
group = SubResource( 2 )
text = "NSteps"
script = ExtResource( 5 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Open" type="Button" parent="Panel/ControllButtons"]
anchor_left = 1.0
anchor_top = 0.2
anchor_right = 1.0
anchor_bottom = 0.2
margin_left = -101.964
margin_top = -1.71591
margin_right = -11.3514
margin_bottom = 18.2841
text = "Open"
script = ExtResource( 5 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Close" type="Button" parent="Panel/ControllButtons"]
anchor_left = 1.0
anchor_top = 0.2
anchor_right = 1.0
anchor_bottom = 0.2
margin_left = -202.632
margin_top = -1.71591
margin_right = -112.019
margin_bottom = 18.2841
text = "Close"
script = ExtResource( 5 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="GraphContainer" type="PanelContainer" parent="Panel"]
material = SubResource( 4 )
anchor_left = 0.247
anchor_top = 0.113
anchor_right = 0.998
anchor_bottom = 0.992
margin_left = -7.10274
margin_top = -5.75864
margin_right = -6.62872
margin_bottom = -6.03766
script = ExtResource( 9 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Lines" type="Node2D" parent="Panel/GraphContainer"]
material = SubResource( 6 )
script = ExtResource( 15 )

[node name="DebugPanel" type="Panel" parent="."]
anchor_left = 1.0
anchor_right = 1.0
margin_left = -511.0
margin_bottom = 600.0
grow_vertical = 2
size_flags_horizontal = 3
size_flags_vertical = 3
script = ExtResource( 1 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="VBoxContainer" type="VBoxContainer" parent="DebugPanel"]
anchor_right = 1.0
anchor_bottom = 0.205
margin_bottom = -7.62939e-06
alignment = 1
__meta__ = {
"_edit_use_anchors_": false
}

[node name="GridContainer" type="GridContainer" parent="DebugPanel/VBoxContainer"]
margin_right = 511.0
margin_bottom = 123.0
rect_clip_content = true
focus_neighbour_bottom = NodePath("../Button")
size_flags_horizontal = 3
size_flags_vertical = 3
custom_constants/vseparation = 3
columns = 5
script = ExtResource( 6 )
__meta__ = {
"_edit_use_anchors_": false,
"_editor_description_": "this is the end
"
}

[node name="Planet" type="Label" parent="DebugPanel/VBoxContainer/GridContainer"]
margin_right = 99.0
margin_bottom = 14.0
size_flags_horizontal = 3
text = "Planet"

[node name="Label2" type="Label" parent="DebugPanel/VBoxContainer/GridContainer"]
margin_left = 103.0
margin_right = 202.0
margin_bottom = 14.0
size_flags_horizontal = 3
text = "Pozicija"

[node name="Label3" type="Label" parent="DebugPanel/VBoxContainer/GridContainer"]
margin_left = 206.0
margin_right = 305.0
margin_bottom = 14.0
size_flags_horizontal = 3
text = "Brzina"

[node name="Label4" type="Label" parent="DebugPanel/VBoxContainer/GridContainer"]
margin_left = 309.0
margin_right = 408.0
margin_bottom = 14.0
size_flags_horizontal = 3
text = "KE"

[node name="Label5" type="Label" parent="DebugPanel/VBoxContainer/GridContainer"]
margin_left = 412.0
margin_right = 511.0
margin_bottom = 14.0
size_flags_horizontal = 3
text = "KG"

[node name="ItemList" type="ItemList" parent="DebugPanel"]
anchor_left = 0.004
anchor_top = 0.553
anchor_right = 1.0
anchor_bottom = 1.0
margin_left = -0.0440001
margin_top = 0.199982
margin_right = 2.0
margin_bottom = -1.0
script = ExtResource( 10 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Panel" type="Panel" parent="DebugPanel"]
anchor_left = 0.004
anchor_top = 0.247
anchor_right = 0.994
anchor_bottom = 0.55
margin_left = -0.0440001
margin_top = 2.8
margin_right = 0.065979
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Restart" type="Button" parent="DebugPanel/Panel"]
anchor_top = 0.2
anchor_bottom = 0.2
margin_left = -1.25153
margin_top = -45.0256
margin_right = 64.7485
margin_bottom = -25.0256
focus_neighbour_top = NodePath("../GridContainer")
group = SubResource( 1 )
text = "Restart"
script = ExtResource( 5 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Pause" type="Button" parent="DebugPanel/Panel"]
anchor_top = 0.2
anchor_bottom = 0.2
margin_left = 70.0
margin_top = -45.0256
margin_right = 120.0
margin_bottom = -25.0256
focus_neighbour_top = NodePath("../GridContainer")
group = SubResource( 2 )
text = "Pause"
script = ExtResource( 5 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Step" type="Button" parent="DebugPanel/Panel"]
anchor_top = 0.2
anchor_bottom = 0.2
margin_left = 150.0
margin_top = -45.0256
margin_right = 200.0
margin_bottom = -25.0256
focus_neighbour_top = NodePath("../GridContainer")
group = SubResource( 2 )
text = "Step"
script = ExtResource( 5 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="NSteps" type="Button" parent="DebugPanel/Panel"]
anchor_top = 0.2
anchor_bottom = 0.2
margin_left = 205.0
margin_top = -45.0256
margin_right = 262.0
margin_bottom = -25.0256
focus_neighbour_top = NodePath("../GridContainer")
group = SubResource( 2 )
text = "NSteps"
script = ExtResource( 5 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Open" type="Button" parent="DebugPanel/Panel"]
anchor_left = 1.0
anchor_top = 0.2
anchor_right = 1.0
anchor_bottom = 0.2
margin_left = -88.7205
margin_top = -45.5593
margin_right = 1.89197
margin_bottom = -25.5593
text = "Open"
script = ExtResource( 5 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="PropsEditGrid" type="GridContainer" parent="DebugPanel/Panel"]
anchor_top = 0.106
anchor_right = 0.998
anchor_bottom = 1.0
margin_top = 0.0259991
margin_right = 0.0119934
script = ExtResource( 12 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="FileDialog" type="FileDialog" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
window_title = "Open a File"
resizable = true
mode = 0
access = 2
show_hidden_files = true
current_dir = "C:/Users/Branimir/source/repos/nbody/Nbody.Gui"
current_path = "C:/Users/Branimir/source/repos/nbody/Nbody.Gui/"
script = ExtResource( 8 )

[node name="PlanetSystem" type="MultiMeshInstance" parent="."]
multimesh = SubResource( 9 )
script = ExtResource( 13 )

[node name="PlanetSystemArrows" type="MultiMeshInstance" parent="."]
multimesh = SubResource( 10 )
script = ExtResource( 14 )
